(function(){'use strict';angular.module("yourcall:services",[]),angular.module("yourcall:directives",[]),angular.module("yourcall:app",["yourcall:services","yourcall:directives","ngRoute","ngCookies"]).config(["$routeProvider","$locationProvider",function(e,t){e.when("/",{templateUrl:"/partials/singlequestion.html"}).when("/ask",{templateUrl:"/partials/newquestion.html",controller:"NewQuestionCtrl",controllerAs:"vm"}).when("/q/:question_url",{templateUrl:"/partials/singlequestion.html",controller:"SingleQuestionCtrl",controllerAs:"vm"}).when("/q/:question_url/result",{templateUrl:"/partials/singlequestion.html",controller:"SingleQuestionCtrl",controllerAs:"vm"}).when("/oops/notfound",{templateUrl:"/partials/notfound.html",controller:"NotFoundCtrl",controllerAs:"vm"}),t.html5Mode(!0)}]).run(["$rootScope","$window","$location",function(e,t,o){e.$on("$viewContentLoaded",function(){t.ga("send","pageview",{page:o.path()})})}]),angular.module("yourcall:app").controller("MainCtrl",["$scope","$http","$location","pageService","questionService","utilityService",function(e,t,o,n,r){e.title=n.getTitle,r.getRandomQuestion().then(function(e){"/"===o.path()&&o.path("/q/"+e.data)})}]),angular.module("yourcall:app").controller("NewQuestionCtrl",["$scope","$location","pageService","questionService","UITextService","appService",function(e,t,o,n,r,i){var l=this;o.setTitle(r.titles.NEW_QUESTION),l.submitted=!1,l.errorMessage="",l.formData={},l.formData.isPrivate=!1,l.createQuestion=function(){l.formData.title&&l.formData.option_1&&l.formData.option_2?l.formData.title.length>i.TITLE_THRESHOLD?l.errorMessage=r.ERROR_LONG_QUESTION:l.formData.option_1.length>i.OPTION_THRESHOLD||l.formData.option_2.length>i.OPTION_THRESHOLD?l.errorMessage=r.ERROR_LONG_OPTION:(l.submitted=!0,l.errorMessage="",n.createQuestion(l.formData).success(function(e){l.formData={},l.newQuestion=e,t.path("/q/"+e.url)})):l.errorMessage=r.ERROR_FIELDS_EMPTY}}]),angular.module("yourcall:app").controller("NotFoundCtrl",["$scope","questionService",function(e,t){var o=this;t.getRandomQuestion().then(function(e){o.questionUrl=e.data})}]),angular.module("yourcall:app").controller("SingleQuestionCtrl",["$scope","$routeParams","$location","questionService","UITextService",function(e,t,o,n,r){var i=this;i.showResult=!1,o.$$path.indexOf("result")>-1&&(i.showResult=!0),i.reportMessage=r.REPORT,i.deleteMessage=r.DELETE,t.question_url&&n.getQuestion(t.question_url).success(function(e){i.question=e,i.isOwnedQuestion=e.owned,i.totalVotes=e.totalVotes}),n.getRandomQuestion().success(function(e){i.nextQuestion=e}),i.deleteQuestion=function(e){i.deleteMessage=r.PENDING_DELETE,n.deleteQuestion(e).success(function(){o.path("/q/"+i.nextQuestion)})},i.vote=function(e,t){e.hasVoted||n.voteOnQuestion(e,t).success(function(){i.totalVotes=e.option_1_votes+e.option_2_votes})},i.reportQuestion=function(e){i.reportMessage=r.REPORTED,n.reportQuestion(e)}}]),angular.module("yourcall:directives").directive("option",function(){return{restrict:"E",templateUrl:"partials/directives/option.html",scope:{},link:function(){}}}),angular.module("yourcall:directives").directive("pollBar",["$timeout","appService",function(e,t){return{restrict:"A",scope:{voted:"@",showResult:"="},link:function(o,n){var r,i,l=document.getElementById("result-1"),s=document.getElementById("result-2"),u=document.querySelector(".option-1"),a=document.querySelector(".option-2"),c=document.getElementById("next-button"),d=function(){r=l.textContent.replace("%","")+"vh",i=s.textContent.replace("%","")+"vh",u.style.height=r,a.style.height=i},p=function(){l.classList.add("show-percentage"),s.classList.add("show-percentage")},f=function(){c.classList.add("shake-rotate")},E=function(){e(d,100),e(p,t.DISPLAY_PERCENTAGES_DELAY),e(f,t.DISPLAY_BUTTON_ANIMATION_DELAY)};o.showResult?E():o.$watch("voted",function(e){e?E():n.on("click",E)})}}}]),angular.module("yourcall:directives").directive("selfRefresh",["$location","$route",function(e,t){return function(o,n){n.bind("click",function(){n[0]&&n[0].href&&n[0].href===e.absUrl()&&t.reload()})}}]),angular.module("yourcall:directives").directive("siteFooter",["$rootScope","$location",function(e,t){return{restrict:"E",templateUrl:"/partials/directives/sitefooter.html",link:function(o,n){e.$on("$routeChangeSuccess",function(){t.path().indexOf("notfound")>-1?n.addClass("hidden"):n.removeClass("hidden")})}}}]),angular.module("yourcall:services").factory("UITextService",function(){var e={titles:{BASE_PAGE_TITLE:"YourCall.io",QUESTION_PAGE_TITLE:"Your Call: ",NEW_QUESTION:"Ask a question"},CONFIRMATION_MESSAGE:"Are you sure?",DELETE:"Delete",PENDING_DELETE:"Deleting...",REPORT:"Report",REPORTED:"Flagged for review",ERROR_LONG_QUESTION:"Please try to shorten your question.",ERROR_LONG_OPTION:"Please try to shorten your options.",ERROR_FIELDS_EMPTY:"Please fill in all fields."};return e}),angular.module("yourcall:services").factory("appService",function(){var e={cookieNames:{OWNED_QUESTIONS:"own_q",VOTES:"votes"},TITLE_THRESHOLD:37,OPTION_THRESHOLD:50,DISPLAY_PERCENTAGES_DELAY:1500,DISPLAY_BUTTON_ANIMATION_DELAY:5e3};return e}),angular.module("yourcall:services").factory("pageService",["UITextService",function(e){var t={},o=e.BASE_PAGE_TITLE;return t.getTitle=function(){return o},t.setTitle=function(t){o=e.titles.QUESTION_PAGE_TITLE+t},t}]),angular.module("yourcall:services").factory("questionService",["$http","$location","$window","UITextService","utilityService","appService","pageService",function(e,t,o,n,r,i,l){var s={};return s.fetchedQuestions=[],s.getRandomQuestion=function(){return e.get("/api/random")},s.deleteQuestion=function(t){var l=o.confirm(n.CONFIRMATION_MESSAGE),s="";if(l){if(r.readCookie(i.cookieNames.OWNED_QUESTIONS))for(var u=r.readCookie(i.cookieNames.OWNED_QUESTIONS).split("|"),a=0;a<u.length;a++)t===u[a].split(":")[0]&&(s=u[a].split(":")[1]);return e.delete("/api/delete/"+t+"?verify="+s)}},s.getQuestion=function(o){var n="",s=r.readCookie(i.cookieNames.VOTES);if(r.readCookie(i.cookieNames.OWNED_QUESTIONS))for(var u=r.readCookie(i.cookieNames.OWNED_QUESTIONS).split("|"),a=0;a<u.length;a++)n+=":"+u[a].split(":")[0];return e.get("/api/questions/"+o).success(function(e){l.setTitle(e.title),s&&s.indexOf(e.url)>-1&&(e.hasVoted=!0),n.indexOf(e._id)>-1&&(e.owned=!0),e.totalVotes=e.option_1_votes+e.option_2_votes}).error(function(){t.path("/oops/notfound")})},s.voteOnQuestion=function(t,o){return e.put("/api/vote/"+t.url+"/"+o).success(function(e){"true"===e.success&&(t["option_"+o+"_votes"]+=1,t.hasVoted=!0)})},s.reportQuestion=function(t){e.put("/api/report/"+t)},s.createQuestion=function(t){return e.post("/api/questions",t)},s.getAllQuestions=function(){return e.get("/api/questions")},s.getReportedQuestions=function(){return e.get("/api/reported")},s}]),angular.module("yourcall:services").factory("utilityService",["$cookies",function(){var e={};return e.readCookie=function(e){for(var t=e+"=",o=document.cookie.split(";"),n=0;n<o.length;n++){for(var r=o[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null},e}]);})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsImNvbnRyb2xsZXJzL21haW5DdHJsLmpzIiwiY29udHJvbGxlcnMvbmV3UXVlc3Rpb25DdHJsLmpzIiwiY29udHJvbGxlcnMvbm90Rm91bmRDdHJsLmpzIiwiY29udHJvbGxlcnMvc2luZ2xlUXVlc3Rpb25DdHJsLmpzIiwiZGlyZWN0aXZlcy9vcHRpb24uanMiLCJkaXJlY3RpdmVzL3BvbGxCYXIuanMiLCJkaXJlY3RpdmVzL3NlbGZyZWZyZXNoLmpzIiwiZGlyZWN0aXZlcy9zaXRlRm9vdGVyLmpzIiwic2VydmljZXMvVUlUZXh0U2VydmljZS5qcyIsInNlcnZpY2VzL2FwcFNlcnZpY2UuanMiLCJzZXJ2aWNlcy9wYWdlU2VydmljZS5qcyIsInNlcnZpY2VzL3F1ZXN0aW9uU2VydmljZS5qcyIsInNlcnZpY2VzL3V0aWxpdHlTZXJ2aWNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFFBQUEsT0FBQSx3QkFDQSxRQUFBLE9BQUEsMEJBRUEsUUFBQSxPQUFBLGdCQUFBLG9CQUFBLHNCQUFBLFVBQUEsY0FDQSxRQUFBLGlCQUFBLG9CQUFBLFNBQUEsRUFBQSxHQUNBLEVBQ0EsS0FBQSxLQUNBLFlBQUEsa0NBRUEsS0FBQSxRQUNBLFlBQUEsNkJBQ0EsV0FBQSxrQkFDQSxhQUFBLE9BRUEsS0FBQSxvQkFDQSxZQUFBLGdDQUNBLFdBQUEscUJBQ0EsYUFBQSxPQUVBLEtBQUEsMkJBQ0EsWUFBQSxnQ0FDQSxXQUFBLHFCQUNBLGFBQUEsT0FFQSxLQUFBLGtCQUNBLFlBQUEsMEJBQ0EsV0FBQSxlQUNBLGFBQUEsT0FHQSxFQUFBLFdBQUEsTUFFQSxLQUFBLGFBQUEsVUFBQSxZQUFBLFNBQUEsRUFBQSxFQUFBLEdBRUEsRUFBQSxJQUFBLHFCQUFBLFdBQ0EsRUFBQSxHQUFBLE9BQUEsWUFBQSxLQUFBLEVBQUEsY0NuQ0EsUUFBQSxPQUFBLGdCQUFBLFdBQUEsWUFBQSxTQUFBLFFBQUEsWUFBQSxjQUFBLGtCQUFBLGlCQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEVBQUEsTUFBQSxFQUFBLFNBRUEsRUFBQSxvQkFBQSxLQUFBLFNBQUEsR0FDQSxNQUFBLEVBQUEsUUFDQSxFQUFBLEtBQUEsTUFBQSxFQUFBLFdDTkEsUUFBQSxPQUFBLGdCQUFBLFdBQUEsbUJBQUEsU0FBQSxZQUFBLGNBQUEsa0JBQUEsZ0JBQUEsYUFBQSxTQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEdBQUEsR0FBQSxJQUVBLEdBQUEsU0FBQSxFQUFBLE9BQUEsY0FFQSxFQUFBLFdBQUEsRUFDQSxFQUFBLGFBQUEsR0FDQSxFQUFBLFlBQ0EsRUFBQSxTQUFBLFdBQUEsRUFFQSxFQUFBLGVBQUEsV0FDQSxFQUFBLFNBQUEsT0FBQSxFQUFBLFNBQUEsVUFBQSxFQUFBLFNBQUEsU0FDQSxFQUFBLFNBQUEsTUFBQSxPQUFBLEVBQUEsZ0JBQ0EsRUFBQSxhQUFBLEVBQUEsb0JBQ0EsRUFBQSxTQUFBLFNBQUEsT0FBQSxFQUFBLGtCQUFBLEVBQUEsU0FBQSxTQUFBLE9BQUEsRUFBQSxpQkFDQSxFQUFBLGFBQUEsRUFBQSxtQkFFQSxFQUFBLFdBQUEsRUFDQSxFQUFBLGFBQUEsR0FFQSxFQUFBLGVBQUEsRUFBQSxVQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsWUFDQSxFQUFBLFlBQUEsRUFDQSxFQUFBLEtBQUEsTUFBQSxFQUFBLFFBSUEsRUFBQSxhQUFBLEVBQUEsdUJDNUJBLFFBQUEsT0FBQSxnQkFBQSxXQUFBLGdCQUFBLFNBQUEsa0JBQUEsU0FBQSxFQUFBLEdBRUEsR0FBQSxHQUFBLElBRUEsR0FBQSxvQkFBQSxLQUFBLFNBQUEsR0FDQSxFQUFBLFlBQUEsRUFBQSxVQ0xBLFFBQUEsT0FBQSxnQkFBQSxXQUFBLHNCQUFBLFNBQUEsZUFBQSxZQUFBLGtCQUFBLGdCQUFBLFNBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUVBLEdBQUEsR0FBQSxJQUVBLEdBQUEsWUFBQSxFQUVBLEVBQUEsT0FBQSxRQUFBLFVBQUEsS0FDQSxFQUFBLFlBQUEsR0FHQSxFQUFBLGNBQUEsRUFBQSxPQUNBLEVBQUEsY0FBQSxFQUFBLE9BRUEsRUFBQSxjQUNBLEVBQUEsWUFBQSxFQUFBLGNBQUEsUUFBQSxTQUFBLEdBQ0EsRUFBQSxTQUFBLEVBQ0EsRUFBQSxnQkFBQSxFQUFBLE1BQ0EsRUFBQSxXQUFBLEVBQUEsYUFJQSxFQUFBLG9CQUFBLFFBQUEsU0FBQSxHQUNBLEVBQUEsYUFBQSxJQUdBLEVBQUEsZUFBQSxTQUFBLEdBQ0EsRUFBQSxjQUFBLEVBQUEsZUFFQSxFQUFBLGVBQUEsR0FBQSxRQUFBLFdBQ0EsRUFBQSxLQUFBLE1BQUEsRUFBQSxpQkFJQSxFQUFBLEtBQUEsU0FBQSxFQUFBLEdBQ0EsRUFBQSxVQUNBLEVBQUEsZUFBQSxFQUFBLEdBQUEsUUFBQSxXQUNBLEVBQUEsV0FBQSxFQUFBLGVBQUEsRUFBQSxrQkFLQSxFQUFBLGVBQUEsU0FBQSxHQUNBLEVBQUEsY0FBQSxFQUFBLFNBQ0EsRUFBQSxlQUFBLE9DM0NBLFFBQUEsT0FBQSx1QkFBQSxVQUFBLFNBQUEsV0FFQSxPQUNBLFNBQUEsSUFDQSxZQUFBLGtDQUNBLFNBR0EsS0FBQSxnQkNSQSxRQUFBLE9BQUEsdUJBQUEsVUFBQSxXQUFBLFdBQUEsYUFBQSxTQUFBLEVBQUEsR0FFQSxPQUNBLFNBQUEsSUFDQSxPQUNBLE1BQUEsSUFDQSxXQUFBLEtBRUEsS0FBQSxTQUFBLEVBQUEsR0FFQSxHQUtBLEdBQ0EsRUFOQSxFQUFBLFNBQUEsZUFBQSxZQUNBLEVBQUEsU0FBQSxlQUFBLFlBQ0EsRUFBQSxTQUFBLGNBQUEsYUFDQSxFQUFBLFNBQUEsY0FBQSxhQUNBLEVBQUEsU0FBQSxlQUFBLGVBSUEsRUFBQSxXQUNBLEVBQUEsRUFBQSxZQUFBLFFBQUEsSUFBQSxJQUFBLEtBQ0EsRUFBQSxFQUFBLFlBQUEsUUFBQSxJQUFBLElBQUEsS0FFQSxFQUFBLE1BQUEsT0FBQSxFQUNBLEVBQUEsTUFBQSxPQUFBLEdBR0EsRUFBQSxXQUNBLEVBQUEsVUFBQSxJQUFBLG1CQUNBLEVBQUEsVUFBQSxJQUFBLG9CQUdBLEVBQUEsV0FDQSxFQUFBLFVBQUEsSUFBQSxpQkFHQSxFQUFBLFdBQ0EsRUFBQSxFQUFBLEtBRUEsRUFBQSxFQUFBLEVBQUEsMkJBRUEsRUFBQSxFQUFBLEVBQUEsZ0NBR0EsR0FBQSxXQVNBLElBUkEsRUFBQSxPQUFBLFFBQUEsU0FBQSxHQUNBLEVBQ0EsSUFFQSxFQUFBLEdBQUEsUUFBQSxVQ2hEQSxRQUFBLE9BQUEsdUJBQUEsVUFBQSxlQUFBLFlBQUEsU0FBQSxTQUFBLEVBQUEsR0FDQSxNQUFBLFVBQUEsRUFBQSxHQUNBLEVBQUEsS0FBQSxRQUFBLFdBQ0EsRUFBQSxJQUFBLEVBQUEsR0FBQSxNQUFBLEVBQUEsR0FBQSxPQUFBLEVBQUEsVUFDQSxFQUFBLGVDSkEsUUFBQSxPQUFBLHVCQUFBLFVBQUEsY0FBQSxhQUFBLFlBQUEsU0FBQSxFQUFBLEdBRUEsT0FDQSxTQUFBLElBQ0EsWUFBQSx1Q0FDQSxLQUFBLFNBQUEsRUFBQSxHQUNBLEVBQUEsSUFBQSxzQkFBQSxXQUNBLEVBQUEsT0FBQSxRQUFBLFlBQUEsR0FDQSxFQUFBLFNBQUEsVUFFQSxFQUFBLFlBQUEsaUJDVkEsUUFBQSxPQUFBLHFCQUFBLFFBQUEsZ0JBQUEsV0FFQSxHQUFBLElBQ0EsUUFDQSxnQkFBQSxjQUNBLG9CQUFBLGNBQ0EsYUFBQSxrQkFFQSxxQkFBQSxnQkFDQSxPQUFBLFNBQ0EsZUFBQSxjQUNBLE9BQUEsU0FDQSxTQUFBLHFCQUNBLG9CQUFBLHVDQUNBLGtCQUFBLHNDQUNBLG1CQUFBLDZCQUdBLE9BQUEsS0NsQkEsUUFBQSxPQUFBLHFCQUFBLFFBQUEsYUFBQSxXQUVBLEdBQUEsSUFDQSxhQUNBLGdCQUFBLFFBQ0EsTUFBQSxTQUVBLGdCQUFBLEdBQ0EsaUJBQUEsR0FDQSwwQkFBQSxLQUNBLCtCQUFBLElBR0EsT0FBQSxLQ2JBLFFBQUEsT0FBQSxxQkFBQSxRQUFBLGVBQUEsZ0JBQUEsU0FBQSxHQUVBLEdBQUEsTUFFQSxFQUFBLEVBQUEsZUFVQSxPQVJBLEdBQUEsU0FBQSxXQUNBLE1BQUEsSUFHQSxFQUFBLFNBQUEsU0FBQSxHQUNBLEVBQUEsRUFBQSxPQUFBLG9CQUFBLEdBR0EsS0NkQSxRQUFBLE9BQUEscUJBQUEsUUFBQSxtQkFBQSxRQUFBLFlBQUEsVUFBQSxnQkFBQSxpQkFBQSxhQUFBLGNBQUEsU0FBQSxFQUFBLEVBQUEsRUFBQSxFQUFBLEVBQUEsRUFBQSxHQUNBLEdBQUEsS0F3R0EsT0F0R0EsR0FBQSxvQkFNQSxFQUFBLGtCQUFBLFdBQ0EsTUFBQSxHQUFBLElBQUEsZ0JBU0EsRUFBQSxlQUFBLFNBQUEsR0FDQSxHQUFBLEdBQUEsRUFBQSxRQUFBLEVBQUEsc0JBQ0EsRUFBQSxFQUVBLElBQUEsRUFBQSxDQUNBLEdBQUEsRUFBQSxXQUFBLEVBQUEsWUFBQSxpQkFTQSxJQUFBLEdBUkEsR0FBQSxFQUFBLFdBQUEsRUFBQSxZQUFBLGlCQUFBLE1BQUEsS0FRQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFDQSxJQUFBLEVBQUEsR0FBQSxNQUFBLEtBQUEsS0FDQSxFQUFBLEVBQUEsR0FBQSxNQUFBLEtBQUEsR0FLQSxPQUFBLEdBQUEsT0FBQSxlQUFBLEVBQUEsV0FBQSxLQUlBLEVBQUEsWUFBQSxTQUFBLEdBQ0EsR0FBQSxHQUFBLEdBQ0EsRUFBQSxFQUFBLFdBQUEsRUFBQSxZQUFBLE1BRUEsSUFBQSxFQUFBLFdBQUEsRUFBQSxZQUFBLGlCQUdBLElBQUEsR0FGQSxHQUFBLEVBQUEsV0FBQSxFQUFBLFlBQUEsaUJBQUEsTUFBQSxLQUVBLEVBQUEsRUFBQSxFQUFBLEVBQUEsT0FBQSxJQUNBLEdBQUEsSUFBQSxFQUFBLEdBQUEsTUFBQSxLQUFBLEVBSUEsT0FBQSxHQUFBLElBQUEsa0JBQUEsR0FDQSxRQUFBLFNBQUEsR0FDQSxFQUFBLFNBQUEsRUFBQSxPQUVBLEdBQUEsRUFBQSxRQUFBLEVBQUEsS0FBQSxLQUNBLEVBQUEsVUFBQSxHQUdBLEVBQUEsUUFBQSxFQUFBLEtBQUEsS0FDQSxFQUFBLE9BQUEsR0FHQSxFQUFBLFdBQUEsRUFBQSxlQUFBLEVBQUEsaUJBRUEsTUFBQSxXQUNBLEVBQUEsS0FBQSxxQkFJQSxFQUFBLGVBQUEsU0FBQSxFQUFBLEdBQ0EsTUFBQSxHQUFBLElBQUEsYUFBQSxFQUFBLElBQUEsSUFBQSxHQUFBLFFBQUEsU0FBQSxHQUNBLFNBQUEsRUFBQSxVQUNBLEVBQUEsVUFBQSxFQUFBLFdBQUEsRUFDQSxFQUFBLFVBQUEsTUFVQSxFQUFBLGVBQUEsU0FBQSxHQUNBLEVBQUEsSUFBQSxlQUFBLElBR0EsRUFBQSxlQUFBLFNBQUEsR0FDQSxNQUFBLEdBQUEsS0FBQSxpQkFBQSxJQUdBLEVBQUEsZ0JBQUEsV0FDQSxNQUFBLEdBQUEsSUFBQSxtQkFHQSxFQUFBLHFCQUFBLFdBQ0EsTUFBQSxHQUFBLElBQUEsa0JBR0EsS0N6R0EsUUFBQSxPQUFBLHFCQUFBLFFBQUEsa0JBQUEsV0FBQSxXQUVBLEdBQUEsS0FlQSxPQWJBLEdBQUEsV0FBQSxTQUFBLEdBSUEsSUFBQSxHQUhBLEdBQUEsRUFBQSxJQUNBLEVBQUEsU0FBQSxPQUFBLE1BQUEsS0FFQSxFQUFBLEVBQUEsRUFBQSxFQUFBLE9BQUEsSUFBQSxDQUVBLElBREEsR0FBQSxHQUFBLEVBQUEsR0FDQSxLQUFBLEVBQUEsT0FBQSxJQUFBLEVBQUEsRUFBQSxVQUFBLEVBQUEsRUFBQSxPQUNBLElBQUEsR0FBQSxFQUFBLFFBQUEsR0FBQSxNQUFBLEdBQUEsVUFBQSxFQUFBLE9BQUEsRUFBQSxRQUdBLE1BQUEsT0FHQSIsImZpbGUiOiJhbGwubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYW5ndWxhci5tb2R1bGUoJ3lvdXJjYWxsOnNlcnZpY2VzJywgW10pO1xyXG5hbmd1bGFyLm1vZHVsZSgneW91cmNhbGw6ZGlyZWN0aXZlcycsIFtdKTtcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCd5b3VyY2FsbDphcHAnLCBbJ3lvdXJjYWxsOnNlcnZpY2VzJywgJ3lvdXJjYWxsOmRpcmVjdGl2ZXMnLCAnbmdSb3V0ZScsICduZ0Nvb2tpZXMnXSlcclxuLmNvbmZpZyhmdW5jdGlvbiAoJHJvdXRlUHJvdmlkZXIsICRsb2NhdGlvblByb3ZpZGVyKSB7XHJcbiAgICAkcm91dGVQcm92aWRlclxyXG4gICAgICAgIC53aGVuKCcvJywge1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9zaW5nbGVxdWVzdGlvbi5odG1sJ1xyXG4gICAgICAgIH0pXHJcbiAgICAgICAgLndoZW4oJy9hc2snLCB7XHJcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL25ld3F1ZXN0aW9uLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTmV3UXVlc3Rpb25DdHJsJyxcclxuICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nXHJcbiAgICAgICAgfSlcclxuICAgICAgICAud2hlbignL3EvOnF1ZXN0aW9uX3VybCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvc2luZ2xlcXVlc3Rpb24uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTaW5nbGVRdWVzdGlvbkN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9KVxyXG4gICAgICAgIC53aGVuKCcvcS86cXVlc3Rpb25fdXJsL3Jlc3VsdCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvc2luZ2xlcXVlc3Rpb24uaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTaW5nbGVRdWVzdGlvbkN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9KVxyXG4gICAgICAgIC53aGVuKCcvb29wcy9ub3Rmb3VuZCcsIHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvbm90Zm91bmQuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdOb3RGb3VuZEN0cmwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bSdcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAkbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcbn0pXHJcbi5ydW4oZnVuY3Rpb24gKCRyb290U2NvcGUsICR3aW5kb3csICRsb2NhdGlvbikge1xyXG4gICAgLy9Hb29nbGUgQW5hbHl0aWNzIHBhZ2UgdHJhY2tpbmdcclxuICAgICRyb290U2NvcGUuJG9uKCckdmlld0NvbnRlbnRMb2FkZWQnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgICR3aW5kb3cuZ2EoJ3NlbmQnLCAncGFnZXZpZXcnLCB7IHBhZ2U6ICRsb2NhdGlvbi5wYXRoKCkgfSk7XHJcbiAgICB9KTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3lvdXJjYWxsOmFwcCcpLmNvbnRyb2xsZXIoJ01haW5DdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgJGh0dHAsICRsb2NhdGlvbiwgcGFnZVNlcnZpY2UsIHF1ZXN0aW9uU2VydmljZSwgdXRpbGl0eVNlcnZpY2UpIHtcclxuXHJcbiAgICAkc2NvcGUudGl0bGUgPSBwYWdlU2VydmljZS5nZXRUaXRsZTtcclxuXHJcbiAgICBxdWVzdGlvblNlcnZpY2UuZ2V0UmFuZG9tUXVlc3Rpb24oKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgIGlmICgkbG9jYXRpb24ucGF0aCgpID09PSAnLycpIHtcclxuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9xLycgKyByZXNwb25zZS5kYXRhKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCd5b3VyY2FsbDphcHAnKS5jb250cm9sbGVyKCdOZXdRdWVzdGlvbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbG9jYXRpb24sIHBhZ2VTZXJ2aWNlLCBxdWVzdGlvblNlcnZpY2UsIFVJVGV4dFNlcnZpY2UsIGFwcFNlcnZpY2UpIHtcclxuICAgIFxyXG4gICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICBwYWdlU2VydmljZS5zZXRUaXRsZShVSVRleHRTZXJ2aWNlLnRpdGxlcy5ORVdfUVVFU1RJT04pO1xyXG5cclxuICAgIHZtLnN1Ym1pdHRlZCA9IGZhbHNlO1xyXG4gICAgdm0uZXJyb3JNZXNzYWdlID0gJyc7XHJcbiAgICB2bS5mb3JtRGF0YSA9IHt9O1xyXG4gICAgdm0uZm9ybURhdGEuaXNQcml2YXRlID0gZmFsc2U7XHJcblxyXG4gICAgdm0uY3JlYXRlUXVlc3Rpb24gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHZtLmZvcm1EYXRhLnRpdGxlICYmIHZtLmZvcm1EYXRhLm9wdGlvbl8xICYmIHZtLmZvcm1EYXRhLm9wdGlvbl8yKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5mb3JtRGF0YS50aXRsZS5sZW5ndGggPiBhcHBTZXJ2aWNlLlRJVExFX1RIUkVTSE9MRCkge1xyXG4gICAgICAgICAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gVUlUZXh0U2VydmljZS5FUlJPUl9MT05HX1FVRVNUSU9OO1xyXG4gICAgICAgICAgICB9IGVsc2UgaWYgKHZtLmZvcm1EYXRhLm9wdGlvbl8xLmxlbmd0aCA+IGFwcFNlcnZpY2UuT1BUSU9OX1RIUkVTSE9MRCB8fCB2bS5mb3JtRGF0YS5vcHRpb25fMi5sZW5ndGggPiBhcHBTZXJ2aWNlLk9QVElPTl9USFJFU0hPTEQpIHtcclxuICAgICAgICAgICAgICAgIHZtLmVycm9yTWVzc2FnZSA9IFVJVGV4dFNlcnZpY2UuRVJST1JfTE9OR19PUFRJT047XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zdWJtaXR0ZWQgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdm0uZXJyb3JNZXNzYWdlID0gJyc7XHJcblxyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb25TZXJ2aWNlLmNyZWF0ZVF1ZXN0aW9uKHZtLmZvcm1EYXRhKS5zdWNjZXNzKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZm9ybURhdGEgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5uZXdRdWVzdGlvbiA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoJy9xLycgKyBkYXRhLnVybCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHZtLmVycm9yTWVzc2FnZSA9IFVJVGV4dFNlcnZpY2UuRVJST1JfRklFTERTX0VNUFRZO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcblxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgneW91cmNhbGw6YXBwJykuY29udHJvbGxlcignTm90Rm91bmRDdHJsJywgZnVuY3Rpb24gKCRzY29wZSwgcXVlc3Rpb25TZXJ2aWNlKSB7XHJcbiAgICBcclxuICAgIHZhciB2bSA9IHRoaXM7XHJcblxyXG4gICAgcXVlc3Rpb25TZXJ2aWNlLmdldFJhbmRvbVF1ZXN0aW9uKCkudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICB2bS5xdWVzdGlvblVybCA9IHJlc3BvbnNlLmRhdGE7XHJcbiAgICB9KTtcclxuXHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCd5b3VyY2FsbDphcHAnKS5jb250cm9sbGVyKCdTaW5nbGVRdWVzdGlvbkN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkcm91dGVQYXJhbXMsICRsb2NhdGlvbiwgcXVlc3Rpb25TZXJ2aWNlLCBVSVRleHRTZXJ2aWNlKSB7XHJcblxyXG4gICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICB2bS5zaG93UmVzdWx0ID0gZmFsc2U7XHJcblxyXG4gICAgaWYoJGxvY2F0aW9uLiQkcGF0aC5pbmRleE9mKCdyZXN1bHQnKSA+IC0xKSB7XHJcbiAgICAgICAgdm0uc2hvd1Jlc3VsdCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgdm0ucmVwb3J0TWVzc2FnZSA9IFVJVGV4dFNlcnZpY2UuUkVQT1JUO1xyXG4gICAgdm0uZGVsZXRlTWVzc2FnZSA9IFVJVGV4dFNlcnZpY2UuREVMRVRFO1xyXG5cclxuICAgIGlmKCRyb3V0ZVBhcmFtcy5xdWVzdGlvbl91cmwpIHtcclxuICAgICAgICBxdWVzdGlvblNlcnZpY2UuZ2V0UXVlc3Rpb24oJHJvdXRlUGFyYW1zLnF1ZXN0aW9uX3VybCkuc3VjY2VzcyhmdW5jdGlvbiAocXVlc3Rpb24pIHtcclxuICAgICAgICAgICAgdm0ucXVlc3Rpb24gPSBxdWVzdGlvbjtcclxuICAgICAgICAgICAgdm0uaXNPd25lZFF1ZXN0aW9uID0gcXVlc3Rpb24ub3duZWQ7XHJcbiAgICAgICAgICAgIHZtLnRvdGFsVm90ZXMgPSBxdWVzdGlvbi50b3RhbFZvdGVzO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHF1ZXN0aW9uU2VydmljZS5nZXRSYW5kb21RdWVzdGlvbigpLnN1Y2Nlc3MoZnVuY3Rpb24gKHVybCkge1xyXG4gICAgICAgIHZtLm5leHRRdWVzdGlvbiA9IHVybDtcclxuICAgIH0pO1xyXG5cclxuICAgIHZtLmRlbGV0ZVF1ZXN0aW9uID0gZnVuY3Rpb24gKHF1ZXN0aW9uSWQpIHtcclxuICAgICAgICB2bS5kZWxldGVNZXNzYWdlID0gVUlUZXh0U2VydmljZS5QRU5ESU5HX0RFTEVURTtcclxuXHJcbiAgICAgICAgcXVlc3Rpb25TZXJ2aWNlLmRlbGV0ZVF1ZXN0aW9uKHF1ZXN0aW9uSWQpLnN1Y2Nlc3MoZnVuY3Rpb24gKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvcS8nICsgdm0ubmV4dFF1ZXN0aW9uKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgdm0udm90ZSA9IGZ1bmN0aW9uIChxdWVzdGlvbiwgdm90ZSkge1xyXG4gICAgICAgIGlmKCFxdWVzdGlvbi5oYXNWb3RlZCkge1xyXG4gICAgICAgICAgICBxdWVzdGlvblNlcnZpY2Uudm90ZU9uUXVlc3Rpb24ocXVlc3Rpb24sIHZvdGUpLnN1Y2Nlc3MoZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICB2bS50b3RhbFZvdGVzID0gcXVlc3Rpb24ub3B0aW9uXzFfdm90ZXMgKyBxdWVzdGlvbi5vcHRpb25fMl92b3RlcztcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICB2bS5yZXBvcnRRdWVzdGlvbiA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgIHZtLnJlcG9ydE1lc3NhZ2UgPSBVSVRleHRTZXJ2aWNlLlJFUE9SVEVEO1xyXG4gICAgICAgIHF1ZXN0aW9uU2VydmljZS5yZXBvcnRRdWVzdGlvbihpZCk7XHJcbiAgICB9O1xyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgneW91cmNhbGw6ZGlyZWN0aXZlcycpLmRpcmVjdGl2ZSgnb3B0aW9uJywgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdFJyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJ3BhcnRpYWxzL2RpcmVjdGl2ZXMvb3B0aW9uLmh0bWwnLFxyXG4gICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGVsZW1lbnQsIGF0dHJzKSB7XHJcblxyXG4gICAgICAgIH1cclxuICAgIH1cclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3lvdXJjYWxsOmRpcmVjdGl2ZXMnKS5kaXJlY3RpdmUoJ3BvbGxCYXInLCBmdW5jdGlvbigkdGltZW91dCwgYXBwU2VydmljZSkge1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICB2b3RlZDogJ0AnLFxyXG4gICAgICAgICAgICBzaG93UmVzdWx0OiAnPSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBlbGVtZW50LCBhdHRycykge1xyXG5cclxuICAgICAgICAgICAgdmFyIHJlc3VsdDEgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0LTEnKSxcclxuICAgICAgICAgICAgICAgIHJlc3VsdDIgICAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0LTInKSxcclxuICAgICAgICAgICAgICAgIG9wdGlvbjEgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uLTEnKSxcclxuICAgICAgICAgICAgICAgIG9wdGlvbjIgICAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3B0aW9uLTInKSxcclxuICAgICAgICAgICAgICAgIG5leHRCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmV4dC1idXR0b24nKSxcclxuICAgICAgICAgICAgICAgIHJlc3VsdDFWYWx1ZSxcclxuICAgICAgICAgICAgICAgIHJlc3VsdDJWYWx1ZTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzZXRCYXJIZWlnaHRzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0MVZhbHVlID0gcmVzdWx0MS50ZXh0Q29udGVudC5yZXBsYWNlKCclJywgJycpICsgJ3ZoJyxcclxuICAgICAgICAgICAgICAgIHJlc3VsdDJWYWx1ZSA9IHJlc3VsdDIudGV4dENvbnRlbnQucmVwbGFjZSgnJScsICcnKSArICd2aCc7XHJcblxyXG4gICAgICAgICAgICAgICAgb3B0aW9uMS5zdHlsZS5oZWlnaHQgPSByZXN1bHQxVmFsdWU7XHJcbiAgICAgICAgICAgICAgICBvcHRpb24yLnN0eWxlLmhlaWdodCA9IHJlc3VsdDJWYWx1ZTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBzaG93UGVyY2VudGFnZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICByZXN1bHQxLmNsYXNzTGlzdC5hZGQoJ3Nob3ctcGVyY2VudGFnZScpO1xyXG4gICAgICAgICAgICAgICAgcmVzdWx0Mi5jbGFzc0xpc3QuYWRkKCdzaG93LXBlcmNlbnRhZ2UnKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIHZhciBuZXh0UXVlc3Rpb25DVEEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBuZXh0QnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3NoYWtlLXJvdGF0ZScpO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgdmFyIGRpc3BsYXlSZXN1bHQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkdGltZW91dChzZXRCYXJIZWlnaHRzLCAxMDApO1xyXG5cclxuICAgICAgICAgICAgICAgICR0aW1lb3V0KHNob3dQZXJjZW50YWdlcywgYXBwU2VydmljZS5ESVNQTEFZX1BFUkNFTlRBR0VTX0RFTEFZKTtcclxuXHJcbiAgICAgICAgICAgICAgICAkdGltZW91dChuZXh0UXVlc3Rpb25DVEEsIGFwcFNlcnZpY2UuRElTUExBWV9CVVRUT05fQU5JTUFUSU9OX0RFTEFZKTtcclxuICAgICAgICAgICAgfTtcclxuXHJcbiAgICAgICAgICAgIGlmKCFzY29wZS5zaG93UmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBzY29wZS4kd2F0Y2goJ3ZvdGVkJywgZnVuY3Rpb24oaGFzVm90ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaGFzVm90ZWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheVJlc3VsdCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsZW1lbnQub24oJ2NsaWNrJywgZGlzcGxheVJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBkaXNwbGF5UmVzdWx0KCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pOyIsImFuZ3VsYXIubW9kdWxlKCd5b3VyY2FsbDpkaXJlY3RpdmVzJykuZGlyZWN0aXZlKCdzZWxmUmVmcmVzaCcsIGZ1bmN0aW9uKCRsb2NhdGlvbiwgJHJvdXRlKXtcclxuICAgIHJldHVybiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICBlbGVtZW50LmJpbmQoJ2NsaWNrJyxmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBpZihlbGVtZW50WzBdICYmIGVsZW1lbnRbMF0uaHJlZiAmJiBlbGVtZW50WzBdLmhyZWYgPT09ICRsb2NhdGlvbi5hYnNVcmwoKSl7XHJcbiAgICAgICAgICAgICAgICAkcm91dGUucmVsb2FkKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gICBcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3lvdXJjYWxsOmRpcmVjdGl2ZXMnKS5kaXJlY3RpdmUoJ3NpdGVGb290ZXInLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJGxvY2F0aW9uKSB7XHJcblxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICByZXN0cmljdDogJ0UnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2RpcmVjdGl2ZXMvc2l0ZWZvb3Rlci5odG1sJyxcclxuICAgICAgICBsaW5rOiBmdW5jdGlvbihzY29wZSwgZWxlbWVudCwgYXR0cnMpIHtcclxuICAgICAgICAgICAgJHJvb3RTY29wZS4kb24oJyRyb3V0ZUNoYW5nZVN1Y2Nlc3MnLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICBpZigkbG9jYXRpb24ucGF0aCgpLmluZGV4T2YoJ25vdGZvdW5kJykgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnQuYWRkQ2xhc3MoJ2hpZGRlbicpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50LnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgneW91cmNhbGw6c2VydmljZXMnKS5mYWN0b3J5KCdVSVRleHRTZXJ2aWNlJywgZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciBVSVRleHRTZXJ2aWNlID0ge1xyXG4gICAgICAgIHRpdGxlczoge1xyXG4gICAgICAgICAgICBCQVNFX1BBR0VfVElUTEU6ICdZb3VyQ2FsbC5pbycsXHJcbiAgICAgICAgICAgIFFVRVNUSU9OX1BBR0VfVElUTEU6ICdZb3VyIENhbGw6ICcsXHJcbiAgICAgICAgICAgIE5FV19RVUVTVElPTjogJ0FzayBhIHF1ZXN0aW9uJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgQ09ORklSTUFUSU9OX01FU1NBR0U6ICdBcmUgeW91IHN1cmU/JyxcclxuICAgICAgICBERUxFVEU6ICdEZWxldGUnLFxyXG4gICAgICAgIFBFTkRJTkdfREVMRVRFOiAnRGVsZXRpbmcuLi4nLFxyXG4gICAgICAgIFJFUE9SVDogJ1JlcG9ydCcsXHJcbiAgICAgICAgUkVQT1JURUQ6ICdGbGFnZ2VkIGZvciByZXZpZXcnLFxyXG4gICAgICAgIEVSUk9SX0xPTkdfUVVFU1RJT046ICdQbGVhc2UgdHJ5IHRvIHNob3J0ZW4geW91ciBxdWVzdGlvbi4nLFxyXG4gICAgICAgIEVSUk9SX0xPTkdfT1BUSU9OOiAnUGxlYXNlIHRyeSB0byBzaG9ydGVuIHlvdXIgb3B0aW9ucy4nLFxyXG4gICAgICAgIEVSUk9SX0ZJRUxEU19FTVBUWTogJ1BsZWFzZSBmaWxsIGluIGFsbCBmaWVsZHMuJ1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gVUlUZXh0U2VydmljZTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3lvdXJjYWxsOnNlcnZpY2VzJykuZmFjdG9yeSgnYXBwU2VydmljZScsIGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICB2YXIgYXBwU2VydmljZSA9IHtcclxuICAgICAgICBjb29raWVOYW1lczoge1xyXG4gICAgICAgICAgICBPV05FRF9RVUVTVElPTlM6ICdvd25fcScsXHJcbiAgICAgICAgICAgIFZPVEVTOiAndm90ZXMnXHJcbiAgICAgICAgfSxcclxuICAgICAgICBUSVRMRV9USFJFU0hPTEQ6IDM3LFxyXG4gICAgICAgIE9QVElPTl9USFJFU0hPTEQ6IDUwLFxyXG4gICAgICAgIERJU1BMQVlfUEVSQ0VOVEFHRVNfREVMQVk6IDE1MDAsXHJcbiAgICAgICAgRElTUExBWV9CVVRUT05fQU5JTUFUSU9OX0RFTEFZOiA1MDAwXHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiBhcHBTZXJ2aWNlO1xyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgneW91cmNhbGw6c2VydmljZXMnKS5mYWN0b3J5KCdwYWdlU2VydmljZScsIGZ1bmN0aW9uIChVSVRleHRTZXJ2aWNlKXtcclxuXHJcbiAgICB2YXIgcGFnZVNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICB2YXIgdGl0bGUgPSBVSVRleHRTZXJ2aWNlLkJBU0VfUEFHRV9USVRMRTtcclxuXHJcbiAgICBwYWdlU2VydmljZS5nZXRUaXRsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gdGl0bGU7XHJcbiAgICB9O1xyXG5cclxuICAgIHBhZ2VTZXJ2aWNlLnNldFRpdGxlID0gZnVuY3Rpb24gKHBhZ2VUaXRsZSkge1xyXG4gICAgICAgIHRpdGxlID0gVUlUZXh0U2VydmljZS50aXRsZXMuUVVFU1RJT05fUEFHRV9USVRMRSArIHBhZ2VUaXRsZTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHBhZ2VTZXJ2aWNlO1xyXG59KTsiLCJhbmd1bGFyLm1vZHVsZSgneW91cmNhbGw6c2VydmljZXMnKS5mYWN0b3J5KCdxdWVzdGlvblNlcnZpY2UnLGZ1bmN0aW9uICgkaHR0cCwgJGxvY2F0aW9uLCAkd2luZG93LCBVSVRleHRTZXJ2aWNlLCB1dGlsaXR5U2VydmljZSwgYXBwU2VydmljZSwgcGFnZVNlcnZpY2UpIHtcclxuICAgIHZhciBxdWVzdGlvblNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICBxdWVzdGlvblNlcnZpY2UuZmV0Y2hlZFF1ZXN0aW9ucyA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogUmV0dXJucyBhIHJhbmRvbSBxdWVzdGlvbiBmcm9tIHRoZSBxdWVzdGlvbnMgQVBJLlxyXG4gICAgICogQHJldHVybiB7cHJvbWlzZX0gcmVwcmVzZW50aW5nIGEgcXVlc3Rpb24gb2JqZWN0XHJcbiAgICAgKi9cclxuICAgIHF1ZXN0aW9uU2VydmljZS5nZXRSYW5kb21RdWVzdGlvbiA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KCcvYXBpL3JhbmRvbScpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIERlbGV0ZXMgdGhlIHF1ZXN0aW9uIHdpdGggW3F1ZXN0aW9uSURdIGZyb20gdGhlXHJcbiAgICAgKiBzZXJ2ZXIgYW5kIHJldHVybnMgYSBuZXcgcmFuZG9tIHF1ZXN0aW9uLlxyXG4gICAgICogQHBhcmFtICB7bnVtYmVyfSBxdWVzdGlvbklkXHJcbiAgICAgKiBAcmV0dXJuIHtwcm9taXNlfSByZXByZXNlbnRpbmcgYSBxdWVzdGlvbiBvYmplY3RcclxuICAgICAqL1xyXG4gICAgcXVlc3Rpb25TZXJ2aWNlLmRlbGV0ZVF1ZXN0aW9uID0gZnVuY3Rpb24gKHF1ZXN0aW9uSWQpIHtcclxuICAgICAgICB2YXIgY29uZmlybURlbGV0ZSA9ICR3aW5kb3cuY29uZmlybShVSVRleHRTZXJ2aWNlLkNPTkZJUk1BVElPTl9NRVNTQUdFKTtcclxuICAgICAgICB2YXIgb3duZXJzaGlwVG9rZW4gPSAnJztcclxuXHJcbiAgICAgICAgaWYgKGNvbmZpcm1EZWxldGUpIHtcclxuICAgICAgICAgICAgaWYgKHV0aWxpdHlTZXJ2aWNlLnJlYWRDb29raWUoYXBwU2VydmljZS5jb29raWVOYW1lcy5PV05FRF9RVUVTVElPTlMpKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgb3duZWQgPSB1dGlsaXR5U2VydmljZS5yZWFkQ29va2llKGFwcFNlcnZpY2UuY29va2llTmFtZXMuT1dORURfUVVFU1RJT05TKS5zcGxpdCgnfCcpO1xyXG5cclxuICAgICAgICAgICAgICAgIC8qb3duZWQuZm9yRWFjaChmdW5jdGlvbiAodG9rZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25JZCA9PT0gb3duZWRbaV0uc3BsaXQoJzonKVswXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvd25lcnNoaXBUb2tlbiA9IG93bmVkW2ldLnNwbGl0KCc6JylbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7Ki9cclxuXHJcbiAgICAgICAgICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgb3duZWQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAocXVlc3Rpb25JZCA9PT0gb3duZWRbaV0uc3BsaXQoJzonKVswXSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvd25lcnNoaXBUb2tlbiA9IG93bmVkW2ldLnNwbGl0KCc6JylbMV07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKCcvYXBpL2RlbGV0ZS8nICsgcXVlc3Rpb25JZCArICc/dmVyaWZ5PScgKyBvd25lcnNoaXBUb2tlbik7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBxdWVzdGlvblNlcnZpY2UuZ2V0UXVlc3Rpb24gPSBmdW5jdGlvbiAocXVlc3Rpb25VcmwpIHtcclxuICAgICAgICB2YXIgb3duZWRRdWVzdGlvbnMgPSAnJyxcclxuICAgICAgICAgICAgdm90ZWRRdWVzdGlvbnMgPSB1dGlsaXR5U2VydmljZS5yZWFkQ29va2llKGFwcFNlcnZpY2UuY29va2llTmFtZXMuVk9URVMpO1xyXG5cclxuICAgICAgICBpZiAodXRpbGl0eVNlcnZpY2UucmVhZENvb2tpZShhcHBTZXJ2aWNlLmNvb2tpZU5hbWVzLk9XTkVEX1FVRVNUSU9OUykpIHtcclxuICAgICAgICAgICAgdmFyIG93bmVkID0gdXRpbGl0eVNlcnZpY2UucmVhZENvb2tpZShhcHBTZXJ2aWNlLmNvb2tpZU5hbWVzLk9XTkVEX1FVRVNUSU9OUykuc3BsaXQoJ3wnKTtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgb3duZWQubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgICAgIG93bmVkUXVlc3Rpb25zICs9ICc6JyArIG93bmVkW2ldLnNwbGl0KCc6JylbMF07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcXVlc3Rpb25zLycgKyBxdWVzdGlvblVybClcclxuICAgICAgICAgICAgLnN1Y2Nlc3MoZnVuY3Rpb24gKHF1ZXN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBwYWdlU2VydmljZS5zZXRUaXRsZShxdWVzdGlvbi50aXRsZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIGlmICh2b3RlZFF1ZXN0aW9ucyAmJiB2b3RlZFF1ZXN0aW9ucy5pbmRleE9mKHF1ZXN0aW9uLnVybCkgPiAtMSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmhhc1ZvdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICBpZiAob3duZWRRdWVzdGlvbnMuaW5kZXhPZihxdWVzdGlvbi5faWQpID4gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICBxdWVzdGlvbi5vd25lZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgcXVlc3Rpb24udG90YWxWb3RlcyA9IHF1ZXN0aW9uLm9wdGlvbl8xX3ZvdGVzICsgcXVlc3Rpb24ub3B0aW9uXzJfdm90ZXM7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5lcnJvcihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAkbG9jYXRpb24ucGF0aCgnL29vcHMvbm90Zm91bmQnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgIHF1ZXN0aW9uU2VydmljZS52b3RlT25RdWVzdGlvbiA9IGZ1bmN0aW9uIChxdWVzdGlvbiwgdm90ZSkge1xyXG4gICAgICAgIHJldHVybiAkaHR0cC5wdXQoJy9hcGkvdm90ZS8nICsgcXVlc3Rpb24udXJsICsgJy8nICsgdm90ZSkuc3VjY2VzcyhmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICBpZiAoZGF0YS5zdWNjZXNzID09PSAndHJ1ZScpIHtcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uWydvcHRpb25fJyArIHZvdGUgKyAnX3ZvdGVzJ10gKz0gMTtcclxuICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmhhc1ZvdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE1vZGlmaWVzIHRoZSBxdWVzdGlvbiwgc2V0dGluZyB0aGUgcmVwb3J0ZWQgZmxhZyB0byB0cnVlLlxyXG4gICAgICogQHBhcmFtICB7bnVtYmVyfSBxdWVzdGlvbklkIFxyXG4gICAgICogQHJldHVybiB7dW5kZWZpbmVkfVxyXG4gICAgICovXHJcbiAgICBxdWVzdGlvblNlcnZpY2UucmVwb3J0UXVlc3Rpb24gPSBmdW5jdGlvbiAocXVlc3Rpb25JZCkge1xyXG4gICAgICAgICRodHRwLnB1dCgnL2FwaS9yZXBvcnQvJyArIHF1ZXN0aW9uSWQpO1xyXG4gICAgfTtcclxuXHJcbiAgICBxdWVzdGlvblNlcnZpY2UuY3JlYXRlUXVlc3Rpb24gPSBmdW5jdGlvbiAobmV3UXVlc3Rpb24pIHtcclxuICAgICAgICByZXR1cm4gJGh0dHAucG9zdCgnL2FwaS9xdWVzdGlvbnMnLCBuZXdRdWVzdGlvbik7XHJcbiAgICB9O1xyXG5cclxuICAgIHF1ZXN0aW9uU2VydmljZS5nZXRBbGxRdWVzdGlvbnMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuICRodHRwLmdldCgnL2FwaS9xdWVzdGlvbnMnKTtcclxuICAgIH07XHJcblxyXG4gICAgcXVlc3Rpb25TZXJ2aWNlLmdldFJlcG9ydGVkUXVlc3Rpb25zID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiAkaHR0cC5nZXQoJy9hcGkvcmVwb3J0ZWQnKTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIHF1ZXN0aW9uU2VydmljZTtcclxufSk7IiwiYW5ndWxhci5tb2R1bGUoJ3lvdXJjYWxsOnNlcnZpY2VzJykuZmFjdG9yeSgndXRpbGl0eVNlcnZpY2UnLCBmdW5jdGlvbiAoJGNvb2tpZXMpIHtcclxuXHJcbiAgICB2YXIgdXRpbGl0eVNlcnZpY2UgPSB7fTtcclxuXHJcbiAgICB1dGlsaXR5U2VydmljZS5yZWFkQ29va2llID0gZnVuY3Rpb24gKG5hbWUpIHtcclxuICAgICAgICB2YXIgbmFtZUVRID0gbmFtZSArICc9JztcclxuICAgICAgICB2YXIgY2EgPSBkb2N1bWVudC5jb29raWUuc3BsaXQoJzsnKTtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaT0wOyBpIDwgY2EubGVuZ3RoOyBpKyspIHtcclxuICAgICAgICAgICAgdmFyIGMgPSBjYVtpXTtcclxuICAgICAgICAgICAgd2hpbGUgKGMuY2hhckF0KDApPT0nICcpIGMgPSBjLnN1YnN0cmluZygxLCBjLmxlbmd0aCk7XHJcbiAgICAgICAgICAgIGlmIChjLmluZGV4T2YobmFtZUVRKSA9PSAwKSByZXR1cm4gYy5zdWJzdHJpbmcobmFtZUVRLmxlbmd0aCwgYy5sZW5ndGgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9O1xyXG5cclxuICAgIHJldHVybiB1dGlsaXR5U2VydmljZTtcclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9