/*! yourcall 03-05-2014 */
var app=angular.module("yourCall",["ngRoute"]);app.config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"/partials/singlequestion.html",controller:"SingleQuestionCtrl"}).when("/ask",{templateUrl:"/partials/newquestion.html",controller:"NewQuestionCtrl"}).when("/:question_url",{templateUrl:"partials/singlequestion.html",controller:"SingleQuestionCtrl"}).when("/oops/notfound",{templateUrl:"/partials/notfound.html"}),b.html5Mode(!0)}]),app.controller("AllCtrl",["$scope","$http",function(a,b){b.get("/api/questions").success(function(b){a.questions=b}).error(function(a){console.log("Error: "+a)})}]),app.controller("NewQuestionCtrl",["$scope","$http","$location","Page",function(a,b,c,d){d.setTitle("Ask a question"),a.submitted=!1,a.success=!1,a.errorMessage="",a.formData={},a.formData.isPrivate=!1,a.createQuestion=function(){a.formData.title&&a.formData.option_1&&a.formData.option_2?a.formData.title.length>37?a.errorMessage="Please try to shorten your question.":a.formData.option_1.length>50||a.formData.option_2.length>50?a.errorMessage="Please try to shorten your options.":(a.submitted=!0,a.errorMessage="",b.post("/api/questions",a.formData).success(function(b){a.formData={},a.success=!0,a.error=!1,a.newQuestion=b,a.questions.push(b),c.path("/"+b.url)}).error(function(a){console.log("Error: "+a)})):a.errorMessage="Please fill in all fields."}}]),app.controller("ReportedCtrl",["$scope","$http",function(a,b){b.get("/api/reported").success(function(b){a.questions=b}).error(function(a){console.log("Error: "+a)})}]),app.factory("Page",function(){var a="YourCall.io";return{title:function(){return a},setTitle:function(b){a="Your Call: "+b}}}),app.directive("slideGraph",["$timeout",function(a){return{restrict:"A",scope:{voted:"@"},link:function(b,c){b.$watch("voted",function(b){function d(){a(function(){e=g.textContent.replace("%","")+"vh",f=h.textContent.replace("%","")+"vh",i.style.height=e,j.style.height=f},100),a(function(){g.classList.add("show-percentage"),h.classList.add("show-percentage")},1500),a(function(){k.classList.add("shake-rotate")},5e3)}var e,f,g=document.getElementById("result-1"),h=document.getElementById("result-2"),i=document.querySelector(".option-1"),j=document.querySelector(".option-2"),k=document.getElementById("next-button");b?d():c.on("click",function(){b&&d()})})}}}]),app.directive("selfRefresh",["$location","$route",function(a,b){return function(c,d){d.bind("click",function(){d[0]&&d[0].href&&d[0].href===a.absUrl()&&b.reload()})}}]),app.controller("MainCtrl",["$scope","$http","$location","Page",function(a,b,c,d){a.Page=d,a.questions=[],b.get("/api/random").success(function(b){a.questions=[],a.questions.push(b[0]),a.question=a.questions[0]}).error(function(a){console.log("Error: "+a)})}]),app.controller("SingleQuestionCtrl",["$scope","$routeParams","$http","$location","Page",function(a,b,c,d,e){function f(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0==e.indexOf(b))return e.substring(b.length,e.length)}return null}function g(){var b="",c=f("votes");if(f("own_q"))for(var d=f("own_q").split("|"),g=0;g<d.length;g++)b+=":"+d[g].split(":")[0];e.setTitle(a.question.title),c&&c.indexOf(a.question._id)>-1&&(a.question.hasVoted=!0,console.log(a.question.hasVoted?"You have voted already.":"You may vote on this.")),b.indexOf(a.question._id)>-1&&(a.ownedQuestion=!0),a.totalVotes=a.question.option_1_votes+a.question.option_2_votes}c.get("/api/random").success(function(b){a.nextQuestion=b[0],a.questions.push(b[0])}).error(function(a){console.log("Error: "+a)}),a.ownedQuestion=!1,b.question_url?(a.question=a.questions.filter(function(a){return a.url===b.question_url})[0],a.question?g():c.get("/api/questions/"+b.question_url).success(function(b){a.questions.unshift(b),a.question=b,g()}).error(function(a){console.log("Error: "+a),d.path("/oops/notfound")})):g(),a.vote=function(b,d){var e=a.questions.indexOf(b);a.question=a.questions[e],a.question.hasVoted||c.put("/api/vote/"+b._id+"/"+d).success(function(b){"true"===b.success&&(a.questions[e]["option_"+d+"_votes"]+=1,a.questions[e].selection=d,a.questions[e].hasVoted=!0,g())}).error(function(a){console.log("Error: "+a)})},a.deleteQuestion=function(a){var b=window.confirm("Are you sure?");if(b){var e="";if(f("own_q"))for(var g=f("own_q").split("|"),h=0;h<g.length;h++)a===g[h].split(":")[0]&&(e=g[h].split(":")[1]);c.delete("/api/delete/"+a+"?verify="+e).success(function(){d.path("/")}).error(function(a){console.log("Error: "+a)})}},a.reportMessage="Report",a.reportQuestion=function(b){a.reportMessage="Flagged for review",c.put("/api/report/"+b).success(function(){})}}]);